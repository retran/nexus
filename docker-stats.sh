#!/bin/bash

# Скрипт для вывода сводной информации по запущенным Docker-контейнерам.
# Использует '|' как безопасный разделитель для корректного форматирования.

# Устанавливаем локаль для предсказуемой и быстрой сортировки.
export LC_ALL=C

# Заголовок с разделителем '|'.
HEADER="NAME|STATUS|MEM_USAGE"

# 1. Формируем данные от 'ps' и 'stats', используя '|' как разделитель.
# 2. Объединяем их с помощью 'join', указав разделитель '-t' '|''.
# 3. С помощью 'sed' удаляем из строки всё, начиная с " / " (лимит памяти).
# 4. Выводим заголовок и результат, отформатированный 'column' с разделителем '-s' '|''.
(
    echo "$HEADER";
    join -t '|' \
        <(docker ps --format '{{.Names}}|{{.Status}}' | sort) \
        <(docker stats --no-stream --format '{{.Name}}|{{.MemUsage}}' | sort) \
    | sed 's| / .*||'
) | column -t -s '|'
